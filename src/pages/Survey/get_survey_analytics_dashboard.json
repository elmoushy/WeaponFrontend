{
  "endpoint": {
    "method": "GET",
    "url": "/api/surveys/admin/surveys/{survey_id}/dashboard/",
    "description": "Get comprehensive analytics dashboard for a specific survey. Provides KPIs, time series data, and questions summary for survey creators, admins, and super admins. Includes response statistics, completion rates, and temporal trends."
  },
  "headers": {
    "required": {
      "Authorization": "Bearer <access_token>",
      "Accept": "application/json"
    },
    "optional": {
      "Content-Type": "application/json"
    }
  },
  "path_parameters": {
    "survey_id": {
      "type": "uuid",
      "description": "Survey ID to get analytics for",
      "example": "123e4567-e89b-12d3-a456-426614174000"
    }
  },
  "query_parameters": {
    "start": {
      "type": "datetime",
      "format": "ISO 8601",
      "description": "Start date for filtering responses (inclusive)",
      "example": "2025-07-01T00:00:00+04:00",
      "optional": true
    },
    "end": {
      "type": "datetime",
      "format": "ISO 8601",
      "description": "End date for filtering responses (inclusive)",
      "example": "2025-08-21T23:59:59+04:00",
      "optional": true
    },
    "group_by": {
      "type": "string",
      "choices": ["day", "week", "month"],
      "description": "Time grouping for time series data",
      "default": "day",
      "example": "day",
      "optional": true
    },
    "tz": {
      "type": "string",
      "description": "Timezone for date calculations",
      "default": "Asia/Dubai",
      "example": "Asia/Dubai",
      "optional": true
    },
    "include_personal": {
      "type": "boolean",
      "description": "Include personally identifiable information in analytics",
      "default": false,
      "example": false,
      "optional": true,
      "note": "When false, excludes PII like unique IP addresses, phone numbers, etc."
    }
  },
  "responses": {
    "200": {
      "description": "Analytics dashboard data retrieved successfully",
      "content": {
        "status": "success",
        "message": "Survey analytics dashboard retrieved successfully",
        "data": {
          "survey": {
            "id": "123e4567-e89b-12d3-a456-426614174000",
            "title": "Customer Satisfaction Survey 2025",
            "visibility": "PUBLIC",
            "status": "submitted",
            "total_questions": 5,
            "created_at": "2025-07-15T10:30:00+04:00",
            "is_active": true
          },
          "kpis": {
            "total_responses": 1250,
            "unique_respondents": 1180,
            "completion_rate": 0.87,
            "average_completion_time": 245.5,
            "authenticated_count": 850,
            "anonymous_count": 400,
            "unique_ips": 890,
            "response_rate_trend": 0.15,
            "last_response_date": "2025-08-21T14:22:33+04:00"
          },
          "time_series": [
            {
              "period": "2025-08-15",
              "period_label": "Aug 15, 2025",
              "response_count": 45,
              "unique_respondents": 42,
              "completion_rate": 0.89
            },
            {
              "period": "2025-08-16",
              "period_label": "Aug 16, 2025", 
              "response_count": 67,
              "unique_respondents": 61,
              "completion_rate": 0.91
            },
            {
              "period": "2025-08-17",
              "period_label": "Aug 17, 2025",
              "response_count": 52,
              "unique_respondents": 48,
              "completion_rate": 0.85
            }
          ],
          "segments": {
            "by_authentication": [
              {
                "segment": "authenticated",
                "count": 850,
                "percentage": 0.68,
                "avg_completion_rate": 0.92
              },
              {
                "segment": "anonymous",
                "count": 400,
                "percentage": 0.32,
                "avg_completion_rate": 0.78
              }
            ],
            "by_completion": [
              {
                "segment": "completed",
                "count": 1088,
                "percentage": 0.87
              },
              {
                "segment": "partial",
                "count": 162,
                "percentage": 0.13
              }
            ]
          },
          "questions_summary": [
            {
              "id": "789e1234-e89b-12d3-a456-426614174002",
              "order": 1,
              "text": "How satisfied are you with our service?",
              "type": "single_choice",
              "is_required": true,
              "answer_count": 1205,
              "skipped_count": 45,
              "answer_rate": 0.964,
              "top_response": "Very Satisfied"
            },
            {
              "id": "456e7890-e89b-12d3-a456-426614174003",
              "order": 2,
              "text": "Which features do you use most?",
              "type": "multiple_choice",
              "is_required": false,
              "answer_count": 1180,
              "skipped_count": 70,
              "answer_rate": 0.944,
              "top_response": "Mobile App"
            },
            {
              "id": "321e6543-e89b-12d3-a456-426614174004",
              "order": 3,
              "text": "Rate our customer support (1-5)",
              "type": "rating",
              "is_required": true,
              "answer_count": 1190,
              "skipped_count": 60,
              "answer_rate": 0.952,
              "top_response": "4"
            }
          ]
        }
      }
    },
    "400": {
      "description": "Bad request - Invalid parameters",
      "content": {
        "status": "error",
        "message": "Invalid query parameters",
        "data": {
          "group_by": ["Invalid choice. Valid options are: day, week, month"],
          "start": ["Invalid datetime format"]
        }
      }
    },
    "401": {
      "description": "Authentication required",
      "content": {
        "detail": "Authentication credentials were not provided."
      }
    },
    "403": {
      "description": "Permission denied",
      "examples": {
        "not_authorized": {
          "content": {
            "status": "error",
            "message": "You don't have permission to view analytics for this survey",
            "data": null
          }
        },
        "insufficient_role": {
          "content": {
            "status": "error", 
            "message": "Analytics dashboard requires admin, super_admin, or creator permissions",
            "data": null
          }
        }
      }
    },
    "404": {
      "description": "Survey not found",
      "content": {
        "status": "error",
        "message": "Survey not found",
        "data": null
      }
    },
    "500": {
      "description": "Internal server error",
      "content": {
        "status": "error",
        "message": "An error occurred while generating analytics dashboard",
        "data": null
      }
    }
  },
  "examples": {
    "basic_dashboard": {
      "description": "Get basic survey analytics dashboard",
      "curl": "curl -X GET 'http://127.0.0.1:8000/api/surveys/admin/surveys/123e4567-e89b-12d3-a456-426614174000/dashboard/' -H 'Authorization: Bearer your_access_token'"
    },
    "filtered_by_date": {
      "description": "Get dashboard with date range filtering",
      "curl": "curl -X GET 'http://127.0.0.1:8000/api/surveys/admin/surveys/123e4567-e89b-12d3-a456-426614174000/dashboard/?start=2025-08-01T00:00:00%2B04:00&end=2025-08-21T23:59:59%2B04:00' -H 'Authorization: Bearer your_access_token'"
    },
    "weekly_grouping": {
      "description": "Get dashboard with weekly time series grouping",
      "curl": "curl -X GET 'http://127.0.0.1:8000/api/surveys/admin/surveys/123e4567-e89b-12d3-a456-426614174000/dashboard/?group_by=week' -H 'Authorization: Bearer your_access_token'"
    },
    "include_personal_data": {
      "description": "Get dashboard including personal identifiable information",
      "curl": "curl -X GET 'http://127.0.0.1:8000/api/surveys/admin/surveys/123e4567-e89b-12d3-a456-426614174000/dashboard/?include_personal=true' -H 'Authorization: Bearer your_access_token'"
    },
    "custom_timezone": {
      "description": "Get dashboard with custom timezone",
      "curl": "curl -X GET 'http://127.0.0.1:8000/api/surveys/admin/surveys/123e4567-e89b-12d3-a456-426614174000/dashboard/?tz=UTC' -H 'Authorization: Bearer your_access_token'"
    }
  },
  "permissions": {
    "authentication": "Required - Valid JWT token",
    "authorization": "Survey creator, admin, or super_admin role required",
    "creator_access": "Survey creators can view analytics for their own surveys",
    "admin_access": "Admins and super_admins can view analytics for any survey",
    "pii_protection": "Personal data (IP addresses, phone numbers) only included when include_personal=true"
  },
  "performance": {
    "target_response_time": "< 300ms for surveys with up to 10,000 responses",
    "optimization": "Uses database query optimization with prefetch_related and select_related",
    "caching": "Consider implementing Redis caching for frequently accessed dashboards",
    "pagination": "Time series data automatically limited to reasonable ranges"
  },
  "data_privacy": {
    "pii_fields": [
      "unique_ips (when include_personal=false, returns 0)",
      "respondent_phone (excluded from counts when include_personal=false)",
      "respondent_email (excluded from analytics when include_personal=false)"
    ],
    "anonymization": "Personal identifiers are excluded by default unless explicitly requested",
    "compliance": "Follows data protection guidelines for survey analytics"
  },
  "kpi_calculations": {
    "completion_rate": "Percentage of responses that answered all required questions",
    "unique_respondents": "Count of distinct respondents (by user_id or session)",
    "response_rate_trend": "Percentage change in response rate compared to previous period",
    "average_completion_time": "Mean time taken to complete survey (in seconds)",
    "answer_rate": "Per-question percentage of responses that provided an answer"
  },
  "time_series_grouping": {
    "day": "Groups responses by calendar day",
    "week": "Groups responses by calendar week (Monday start)",
    "month": "Groups responses by calendar month"
  },
  "notes": {
    "timezone_handling": "All datetime fields use UAE timezone (+04:00) by default",
    "encryption": "Survey title and question text are decrypted for display",
    "real_time": "Data is calculated in real-time from current database state",
    "question_types": "Supports analytics for all question types: text, textarea, single_choice, multiple_choice, rating, yes_no",
    "filtering": "Date filtering is inclusive of start and end dates",
    "empty_data": "Returns structured response even when no responses exist"
  }
}
